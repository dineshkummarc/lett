var lettlib;lettlib||(lettlib={}),lettlib.core={"+":function(){var a,b=parseInt(arguments[0],10);for(a=1;a<arguments.length;a++)b+=parseInt(arguments[a],10);return b},"-":function(){var a,b=parseInt(arguments[0],10);for(a=1;a<arguments.length;a++)b-=parseInt(arguments[a],10);return b},"/":function(){var a,b=parseInt(arguments[0],10);for(a=1;a<arguments.length;a++)b/=parseInt(arguments[a],10);return b},"*":function(){var a,b=parseInt(arguments[0],10);for(a=1;a<arguments.length;a++)b*=parseInt(arguments[a],10);return b},str:function(){var a,b="";for(a=0;a<arguments.length;a++)b+=arguments[a];return b},array:function(){return Array.prototype.slice.call(arguments)},">":function(a,b){return a=parseInt(a,10),b=parseInt(b,10),a>b},"<":function(a,b){return a=parseInt(a,10),b=parseInt(b,10),a>b},"==":function(a,b){return a===b},"if":function(a,b,c){return a?b:c}},typeof module!="undefined"&&Object.keys(lettlib.core).forEach(function(a){exports[a]=lettlib.core[a]});var lettlib;lettlib||(lettlib={}),lettlib.parse=function(){function a(a){var b,c,d=!1,e="",f=[];while((b=a.search(/[\{\}'"\(\) ]/))>=0)e+=a.slice(0,b+1),c=a.charAt(b),a=a.slice(b+1),c.match(/'|"/)&&(d=d===c?!1:c),d||(e.match(/\)$|\}$/)&&(f.push(e.slice(0,-1).trim()),e=e.slice(-1)),f.push(e.trim()),e="");return f.push(a.trim()),f}function b(a){var b=[],c=0,d=b,e=[];return a.forEach(function(a){d.push(a),a.match(/\{|\(/)?(e[c]=d,d=[],e[c].push(d),c++):a.match(/\}|\)/)&&(c--,d=e[c])}),b}function c(a){var b,d,e={"(":"fn","{":"obj",'"':"str","'":"str"};return a.map(function(a){var f,g=e[(""+a).charAt(0)];if(Array.isArray(a))b.children=c(a);else{f=b&&b.children,f=f&&f[f.length-1],g==="fn"&&f&&(""+f.val).match(/\)/)&&(g="call",a=b),b={},(""+a).length>1&&(""+a).match(/\($/)&&(g="call",a=a.slice(0,-1),a.match(/^\./)&&(d.chain=b)),g?b.type=g:b.val=a,g==="call"?b.val=a:g==="str"&&(b.val=a.slice(1,-1));if(d&&d.chain){d=b;return}return d=b,b}}).filter(function(a){return a&&(""+a.val).length>0})}function d(a){return Array.isArray(a)?a.map(d):(a.children&&(a.children=a.children.slice(0,-1).map(d)),a.chain&&(a.chain=d(a.chain)),a)}function e(a){return a.replace(/\/\/.*\n/g,"")}function f(f){var g,h;return f=e(f),h=a(f),g=b(h),g=c(g),g=d(g),g}return f}(),typeof module!="undefined"&&(module.exports=lettlib.parse);var lettlib,_;typeof require!="undefined"&&(lettlib={parse:require("./parselib.js"),core:require("./corelib.js")},_=require("underscore"));var lett=function(){function b(a,b){var c=b;return a.split(/\./).forEach(function(a){var b=c;c=c&&c[a],typeof c=="undefined"&&(c=this[a]),typeof c=="undefined"&&(c=lettlib.core[a]),typeof c=="undefined"&&_&&(c=_[a])}),c}function c(c,d){var e;if(c)return e=parseInt(c.val,10),isNaN(e)?(e=a[c.type],e?e(c,d):(e=b(c.val,d),typeof e!="undefined"?e:null)):e}function d(a,b){var d,e=b;return a.length===2?(d=a[0].split(/\./),d.slice(0,-1).forEach(function(a){e[a]||(e[a]=e={})}),e[d.slice(-1)]=c(a[1],{}),b):c(a,b)}function e(a){var b,c=[],d=0;return a.forEach(function(e,f){d%2===0?!e.type&&f<a.length-1?(b=e.val,d++):c.push(e):(c.push([b,e]),d++)}),c}function f(a,b){return a=e(a),a.slice(0,-1).forEach(function(a){d(a,b)}),d(a.slice(-1)[0],b)}function g(a){var b=lettlib.parse(a);return b=f(b,{}),b}var a;return a={obj:function(a,b){var c=e(a.children);return c.forEach(function(a){d(a,b)}),b},call:function(d,e){var f,g,h;return d.val.ret?f=d.val.ret:(h=d.val.split(".").slice(0,-1).join(""),h=b(h,e)),g=d.children.map(function(a){return c(a,e)}),f||(d.val.match(/^\./)&&(d.val=d.val.slice(1),h=e),f=b(d.val,e)),f&&(f=f.apply(h,g)),f&&d.chain?a.call(d.chain,f):f},fn:function(a,b){var c=[],d=0,e,g;return a.children.every(function(a,b){if(!a.type)return c.push(a.val),d++,!0}),e=a.children.slice(d),g=function(){var a=arguments;return c.forEach(function(c,d){b[c]=a[d]}),f(e,b)},a.ret=g,g},str:function(a){return a.val}},g}();typeof module!="undefined"&&(module.exports=lett);